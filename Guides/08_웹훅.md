# 웹훅 @jieun

# 웹훅

웹훅이란 특정 이벤트가 발생했을 때, 실시간으로 이벤트에 대한 정보를 가맹점 서버로 전달하는 기능을 말합니다. 예를 들어, 새로운 주문이 생성되거나, 구독 상태가 변경되었을 때 이를 즉시 가맹점에게 알려줍니다.

## 연관된 가이드

웹훅 사용 가이드는 다음과 같은 문서들과 관련이 있습니다:

- [주문 가이드](%E1%84%8C%E1%85%AE%E1%84%86%E1%85%AE%E1%86%AB%20@yeon%20e79a05791f484a5fbf8fbf7f96f13220.md): 주문과 관련된 웹훅 이벤트에 대해 설명합니다.
- [구독 가이드](%E1%84%80%E1%85%AE%E1%84%83%E1%85%A9%E1%86%A8%20@hansol%20aad6d2150a2a4a93a83984f9036d18cb.md): 구독 상태 변경과 관련된 웹훅 이벤트에 대해 설명합니다.
- [결제 가이드](%E1%84%80%E1%85%A7%E1%86%AF%E1%84%8C%E1%85%A6%20@jung%20c72baefbac814a35981fdfb840397214.md): 결제와 관련된 웹훅 이벤트에 대해 설명합니다.

## 사전 준비 작업

웹훅을 사용하려면 먼저 **[스텝페이 포탈 > 설정 > 결제 설정 > 웹훅 설정](https://portal.steppay.kr/setting/webhook)**에서 웹훅을 등록해야 합니다.

![스크린샷 2023-06-08 오후 3.39.30.png](%E1%84%8B%E1%85%B0%E1%86%B8%E1%84%92%E1%85%AE%E1%86%A8%20@jieun%2041d9299d814d4d00a97fc941e775839c/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-06-08_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_3.39.30.png)

## ****웹훅 이벤트 유형 알아보기****

웹훅 이벤트는 다음과 같습니다. 이벤트 유형별로 연동 설정이 가능하며, 각 이벤트는 특정 상황에서 발생합니다.

| 이벤트 유형 | 설명 |
| --- | --- |
| 주문 | 갱신 주문이 성공했을 때 호출됩니다. 최초 주문은 호출되지 않습니다. |
| 구독 | 구독의 상태가 변경되었을 때 호출됩니다. 최초 생성시에도 호출됩니다. |
| 결제 | '스텝페이 결제 기능만 이용하는 경우'에만 사용 가능합니다. 결제가 발생했을 때 호출됩니다. |

## 주의사항

<aside>
🚨 웹훅은 인증 없이 동작하기 때문에 웹훅 엔드포인트 주소가 노출될 경우 악용될 가능성이 있습니다. 따라서 웹훅을 통해 전달받은 정보는 항상 백엔드에서 한 번 더 주문이나 결제 또는 구독에 대한 검증을 거친 후에 처리하시기 바랍니다.

</aside>

# 연동 가이드

아래에서는 각 웹훅 이벤트에 대해 어떤 정보를 받을 수 있는지, 그리고 이 정보를 어떻게 사용해야 하는지에 대해 설명합니다.

## 주문 웹훅

갱신 주문이 성공했을 때 발생하며, 이를 통해 실시간으로 성공 알림을 받을 수 있습니다. 실패했을 때는 웹훅이 전송되지 않습니다. **단, 최초 주문시엔 발생하지 않습니다.**

![스크린샷 2023-06-08 오후 9.04.13.png](%E1%84%8B%E1%85%B0%E1%86%B8%E1%84%92%E1%85%AE%E1%86%A8%20@jieun%2041d9299d814d4d00a97fc941e775839c/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-06-08_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_9.04.13.png)

### 요청 형식

| HTTP Method | POST |
| --- | --- |
| Content-Type | application/json |

### 웹훅 본문

---

**webHookType** 필수 String

웹훅 타입

- `PAYMENT`: 결제가 완료된 주문 상태

---

**orderId** 필수 Long

주문 아이디

---

```json
{
  "webHookType": "PAYMENT",
  "orderId": 1
}
```

## 구독 웹훅

구독 상태 변경 웹훅은 구독의 상태가 변경되었을 때 발생합니다. 구독의 상태가 활성화, 일시정지, 만료 등으로 변경되었을 때 실시간으로 이를 알 수 있습니다. 구독 최초 생성 시에도 웹훅이 발생합니다.

![스크린샷 2023-06-08 오후 9.03.28.png](%E1%84%8B%E1%85%B0%E1%86%B8%E1%84%92%E1%85%AE%E1%86%A8%20@jieun%2041d9299d814d4d00a97fc941e775839c/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-06-08_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_9.03.28.png)

### 요청 형식

| HTTP Method | POST |
| --- | --- |
| Content-Type | application/json |

### 웹훅 본문

---

**id** 필수 Long

구독 아이디

---

**status** 필수 String

구독 상태

- `ACTIVE` : 활성화
- `UNPAID` : 결제 실패
- `PENDING_PAUSE` : 일시정지 예정
- `PAUSE` : 일시 정지
- `PENDING_CANCEL` : 취소 예정
- `EXPIRED` : 구독 만료
- `CANCELED` : 사용자에 의한 취소

---

```json
{
  "id": 1,
  "status": "ACTIVE"
}
```