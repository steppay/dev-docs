# 결제 SDK

스텝페이는 결제를 위한 Javascript SDK 를 제공하고 있습니다.

결제 영역 Iframe 처리 및 결제 결과를 쉽게 처리할 수 있습니다.

## 연관된 가이드

- [Self 결제](./07-2_Self_결제.md)

### Step1: SDK 설치

- `<script>` 태그에 스텝페이 JS SDK 를 추가합니다.

```html
<script src="https://cdn.steppay.kr/js/steppay-0.7.1.js" type="application/javascript"></script>
```

### Step2: 결제 메소드 호출

requestPay 메소드를 호출합니다.

```jsx
Steppay.requestPay({
            paymentKey: `${ PaymentKey }`,
						paymentGateway: 'KAKAO',
            paymentMethod: 'CARD',
            partner: {
                partnerOrderId : `${가맹점이 관리하는 주문번호}`,
                partnerUserId: `${가맹점이 관리하는 고객번호}`
            },
            product : {
                itemName : `${가맹점이 관리하는 상품이름}`,
                amount : `${결제되어야 할 금액}`,
                quantity : `${총 수량}`,
                currency : 'KRW' // 고정
            },
            customer : {
                userName : `${가맹점이 관리하는 고객 이름}`,
                phone : `${가맹점이 관리하는 고객 휴대폰번호}`,
                email : `${가맹점이 관리하는 고객 이메일}`
            },
        }).cancel((d)=>{
            console.log("cancel" , d)
        }).success((d)=>{
            console.log("success" , d)
        }).error((d)=>{
            console.log("error" , d)
        })
```

|  |  | 타입                                              |                                                                                                                                |
| --- | --- |-------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------|
| paymentKey | 필수 | String                                          | [paymentKey](./01_인증.md)는 브라우저에서 스텝페이 결제 SDK를 사용하기 위한 키 값이며 [인증키 관리 페이지](https://portal.steppay.kr/setting/key)에서 확인하실 수 있습니다. |
| paymentGateway | 필수 | [지원하는 PG 및 결제수단 목록](./07-0_결제.md#지원하는-pg-및-결제수단) |                                                                                                                                |
| paymentMethod | 필수 | [지원하는 PG 및 결제수단 목록](./07-0_결제.md#지원하는-pg-및-결제수단)                 |                                                                                                                                |
| partner.partnerOrderId | 필수 | String                                          | 가맹점에서 관리하는 주문번호                                                                                                                |
| partner.partnerUserId | 필수 | String                                          | 가맹점에서 관리하는 고객번호                                                                                                                |
| product.itemName | 필수 | String                                          | 상품 이름                                                                                                                          |
| product.amount | 필수 | Number                                          | 결제 금액                                                                                                                          |
| product.quantity | 필수 | Number                                          | 수량                                                                                                                             |
| customer.userName | 필수 | String                                          | 이름                                                                                                                             |
| customer.phone | 필수 | String                                          | 휴대폰 번호                                                                                                                         |
| customer.email | 필수 | String                                          | 이메일                                                                                                                            |

### Step3: 결제 결과 검증

- 결제 SDK success 콜백에 검증 API 호출

```jsx
~.success((d)=>{
		const idKey = d.idKey
		fetch('결제 검증 API URL', {
        method: 'POST',
				headers: {
			    "Content-Type": "application/json",
			  },
			  body: JSON.stringify({
			    idKey: idKey,
					status: "성공"
			  }),
    })
    .then(response => response.json())
    .then(data => {
        // 결제 완료 또는 결제 실패 데이터 표시
    })
    .catch((error) => {
      console.error('Error:', error);
    });
    console.log("cancel" , d)
}).error((d)=>{
		// Display error
    console.log("error" , d)
})
```

- ‘결제 검증 API’ 내에서 스텝페이로 결제 검증 예시 (Node)

```jsx
const axios = require('axios');

let config = {
  method: 'get',
  url: 'https://api.steppay.kr/api/payment/receipt/${idKey}',
  headers: { 
    'Secret-Token': '${secretToken}'
  }
};

axios.request(config)
.then((response) => {
	const receiptResponse = JSON.stringify(response.data);
	// status 가 성공이면
	if(status == "성공" && receiptResponse.paymentStatus === "SUCCESS") {
		// do some logic
	}else {
		// something went wrong
	}
	if(status == "error" && receiptResponse.paymentStatus === "PAYMENT_FAILURE") {
		// do some logic
	}else {
		// something went wrong
	}
})
.catch((error) => {
  console.log(error);
});
```