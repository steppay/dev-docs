---
stoplight-id: 3hyzodwuf0v2h
---

# 사용량 기반 요금제 가이드

사용량 기반 요금제는 사용자가 실제로 사용한 양에 따라 요금이 부과되는 가격 플랜입니다. 사용량 과금은 기본적으로 구간을 나누어 특정 구간에 과금 템플릿을 적용하게 됩니다. 이 템플릿을 사용량 테이블이라고도 합니다.
스텝페이에서 지원하는 사용량 템플릿은 크게 두 가지가 있습니다.

1. 고정 요금 템플릿
2. 건당 과금 템플릿

사용량 템플릿이란 사용량의 과금 방식을 결정하는 가격 계산 템플릿 입니다. 고정 요금 템플릿은 사용량 구간에 대해 고정된 요금을 과금합니다. 건당 과금 템플릿은 사용량 구간에 대해 건당 요금을 과금합니다.
사용량 기반 과금의 결제는 정해진 구독 주기 동안 사용량이 합산되어 결제됩니다. 
현재 사용량 결제는 후불 결제만 지원되며, 수량은 지정할 수 없습니다. 사용량을 선불 결제하는 경우에도 후불과 같은 방식으로 동작합니다. 
사용량 후불 결제는 추가 사용량까지 모두 합산하여 다음 결제 예정일에 결제됩니다. 사용량 기반 요금제는 구독 갱신 결제 시 사용량이 모두 초기화 됩니다.

## 연관 가이드

- [인증 가이드](./01_인증.md)
- [상품 가이드](./03_상품.md)
- [가격 플랜 가이드](./04-0_가격플랜.md)
- [구독 가이드](./06_구독..md)
- [과금모델: 사용량 기반 (고정)](https://www.notion.so/e9b7bfab050f4f14af5055c8d4474fc7?pvs=21)
- [과금모델: 사용량 기반 (건당)](https://www.notion.so/86d7e3bd47fb4a56b34c11b4028f051e?pvs=21)
- [사용량 수동 추가하기](https://www.notion.so/d572d4cc9ff54a85afc89f9942bbe22a?pvs=21)

## 사전 준비 작업

- [Secret-Token 확인하기](./01_인증.md#1-secret-token)
- 스텝페이 포탈 또는 API를 통해 사용량 상품이 생성되어 있어야 합니다.
  > 현재 V1 API를 통해 사용량 템플릿을 생성할 수 없기 때문에 사용량 가격 플랜은 포탈에서 생성해야 합니다.
- 스텝페이 포탈 또는 API를 통해 청구서를 발송합니다.
- 발송된 청구서를 결제하면 주문과 구독이 생성됩니다.

## 사용량 과금 템플릿

### 고정 사용량 기반 요금제

고정 사용량 기반 요금제란, 사용량 구간에 대해 고정 금액을 청구하는 방식입니다. 이 요금제는 정해진 사용량 구간에 해당하는 고정 요금을 지불하게 됩니다. 특정 구간을 넘어서면 다음 구간의 요금과 합산되어 누적된
금액이 결제됩니다.

![range_template.png](https://docs-image-translator-qpz5cerjg-steppay.vercel.app/api/localize?dir=04_price_plan&name=04-1_사용량/range_template.png)

예를 들어, API 호출 구간에 대해 고정 사용량 요금제를 아래와 같이 만들 수 있습니다.

![range_template_example.png](https://docs-image-translator-qpz5cerjg-steppay.vercel.app/api/localize?dir=04_price_plan&name=04-1_사용량/range_template_example.png)

- `1,000건`을 사용한 경우, 총 0원이 결제됩니다.
- `1,500건`을 사용한 경우, (0원 + 20,000원)을 합산하여 총 20,000원이 결제됩니다.
- `12,000건`을 사용한 경우, (20,000원 + 40,000원)을 합산하여 총 60,000원이 결제됩니다.
- `150,000건`을 사용한 경우, (20,000원 + 40,000원 + 60,000원 + 80,000원)을 합산하여 총 200,000원이 결제됩니다.

### 건당 사용량 기반 요금제

건당 사용량 기반 요금제란, 사용량 구간에 대해 건당 금액을 청구하는 방식입니다. 이 요금제는 정해진 구간에 대해 건당 요금을 부과하게 됩니다. 전체 사용 건수가 특정 구간을 넘어서면 다음 구간의 요금으로 건당
요금이 부과됩니다.

![range_template_example.png](https://docs-image-translator-qpz5cerjg-steppay.vercel.app/api/localize?dir=04_price_plan&name=04-1_사용량/count_template.png)

예를 들어, API 사용량을 건당 사용량 요금제로 만들면 아래와 같이 만들 수 있습니다.

![range_template_example.png](https://docs-image-translator-qpz5cerjg-steppay.vercel.app/api/localize?dir=04_price_plan&name=04-1_사용량/count_template_example.png)

- `1,000건`을 사용한 경우, 총 0원이 결제됩니다.
- `1,500건`을 사용한 경우, (0원 * 1,000건) + (10원 * 500건)을 합산하여 총 5,000원이 결제 됩니다.
- `12,000건`을 사용한 경우, (0원 * 1,000건) + (10원 * 9,000건) + (5원 * 2,000건)을 합산하여 총 100,000원이 결제됩니다.
- `150,000건`을 사용한 경우, (0원 * 1,000건 + 10원 * 9,000건 + 5원 * 40,000건 + 2원 * 50,000건 + 1원 * 50,000건)을 합산하여 총 440,000원이 결제됩니다.

## API 사용 예시

| 기능                                                                | Method | Endpoint                                                                |
|-------------------------------------------------------------------|--------|-------------------------------------------------------------------------|
| [사용량/계정 기록](https://docs.steppay.kr/reference/createunitrecords)  | POST   | /v1/usage_records                                                       |
| [사용량 정산](https://docs.steppay.kr/reference/calculatesubscription) | GET    | /v1/subscriptions/{subscriptionId}/calculate                            |
| [선불 사용량 추가](https://docs.steppay.kr/reference/addusage)           | POST   | /v1/subscriptions/{subscriptionId}/add-usage-order/{subscriptionItemId} |

### 사용량/계정 기록

- Request
    ```bash
    curl --request POST \
         --url https://api.steppay.kr/api/v1/usage_records \
         --header 'Secret-Token: {Secret-Token}' \
         --header 'accept: */*' \
         --header 'content-type: application/json' \
         --data '
    {
      "subscriptionItemId": {구독항목번호},
      "quantity": {사용량}
    }
    ```

- Response
    ```bash
    [
        {
            "id": {구독번호},
            "subscriptionItemId": {구독아이템번호},
            "payload": null,
            "status": "IN",
            "startDate": "2023-06-07T11:43:14",
            "endDate": null,
            "quantity": 1000,
            "via": "V1",
            "accumulated": 1000
        }
        ...
    ]
    ```

### 사용량 정산

- Request
    ```bash
    curl --request GET \
         --url https://api.steppay.kr/api/v1/subscriptions/{구독번호}/calculate \
         --header 'Secret-Token: {Secret-Token}' \
         --header 'accept: */*'
    ```

- Response
    ```bash
    {
        "amount": 200000,
        "items": [
            {
                "subscriptionItemId": {구독아이템번호},
                "count": 150000,
                "amount": 200000,
                "name": "사용량 고정 템플릿",
                "type": "SKU",
                "unit": "건",
                "additionalBillings": {
                    "id": 920,
                    "type": "USAGE_BASED_WITH_RANGE_AND_FIXED_PRICE",
                    "ranges": [
                        {
                            "id": 1745,
                            "until": 1000,
                            "price": 0.0000
                        },
                        {
                            "id": 1746,
                            "until": 10000,
                            "price": 20000.0000
                        },
                        {
                            "id": 1747,
                            "until": 50000,
                            "price": 40000.0000
                        },
                        {
                            "id": 1748,
                            "until": 100000,
                            "price": 60000.0000
                        },
                        {
                            "id": 1749,
                            "until": -1,
                            "price": 80000.0000
                        }
                    ]
                }
            }
        ],
        "startDate": "2023-06-07T11:28:36",
        "endDate": "2023-07-07T11:28:36"
    }
    ```

### 선불 사용량 추가

현재 선불 사용량 기능 개편중에 있습니다. 선불 사용량 추가에 대한 자세한 내용은 스텝페이로 문의주시기 바랍니다.

## 스텝페이 포탈 사용 예시

- [정기구독 관리] 메뉴에서 사용량 구독항목의 가장 오른쪽 ‘사용량 추가’ 또는 구독 상세 페이지에서 추가할 수 있습니다.
    - 사용량 버튼으로 사용량 추가하기

      ![add_usage_1.png](https://docs-image-translator-qpz5cerjg-steppay.vercel.app/api/localize?dir=04_price_plan&name=04-1_사용량/add_usage_1.png)

    - 구독 상세 페이지에서 사용량 추가하기

      ![add_usage_3.png](https://docs-image-translator-qpz5cerjg-steppay.vercel.app/api/localize?dir=04_price_plan&name=04-1_사용량/add_usage_3.png)

## 사용량 기반 요금제 과금

### 첫 결제 할인

사용량 템플릿에 ‘첫 결제 할인’ 플랜 위젯을 적용하는 경우, 플랜의 기본 금액에 대해 할인된 가격으로 결제됩니다. 현재 사용량 합계에 대한 할인은 제공되지 않습니다.

### 사용량 구독 취소

사용량 구독을 취소하는 경우, 플랜의 기본 금액에 대해 환불되며 이미 사용한 사용량에 대해서는 따로 환불 처리를 하지 않으면 후불 결제됩니다. 
사용량 환불을 원하는 경우에는 취소된 구독의 ‘관련 주문 탭’에서 사용량 주문을 환불 처리해야 합니다.

## 사용량 알림

### 결제 예정 알림

정해진 구독 주기 동안의 사용량이 합산되어 결제되는 ‘사용량 기반 상품'의 경우, 결제 예정일 7일 전에 안내 메일이 발송됩니다. 
고객은 사용량이 얼마나 되고, 어떤 과금에 의하여 결제 금액이 과금되는지 상세 내역을 확인할 수 있습니다.

### 결제 완료 알림

결제 완료시 결제 완료 메일이 발송됩니다. 고객은 사용량이 얼마나 되고, 어떤 과금에 의하여 결제 금액이 과금되는지 상세 내역을 확인할 수 있습니다.