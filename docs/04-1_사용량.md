---
stoplight-id: 3hyzodwuf0v2h
---

# 사용량 기반 요금제 가이드
사용량/계정수 기반 요금제는 사용자가 실제로 사용한 양에 따라 요금이 부과되는 가격 플랜입니다. API 호출 횟수, 스토리지 사용량, 등록된 계정수 등에 따라 결제 금액이 산정되는 요금제를 만들때 유용합니다. 고객의 사용 기록은 연동 개발, 혹은 스텝페이 관리자 페이지(포탈)을 통해 미터링 되며 플랜 옵션에 따라 정기적으로 갱신 결제됩니다. 최대 사용량을 제한함으로써 고객이 일정 유닛 이상 기능을 사용하지 못하게 제한할 수도 있으며 현재 사용량을 조회하여 고객에게 안내할 수도 있습니다.

스텝페이에서는 다양한 요금제 지원을 위해 사용량/계정수 템플릿을 여러 옵션의 조합으로 구성할 수 있습니다. 만드려는 요금제에 따라 사용량/계정수, 선불/후불, 구간별 건당과금/고정요금 등을 자유롭게 선택, 조합하여 유연한 요금 플랜을 설계할 수 있습니다.

## 연관된 가이드

- [인증 가이드](https://steppay.stoplight.io/docs/guide/urvjmavys1lar-)
- [상품 가이드](https://steppay.stoplight.io/docs/guide/6lao84lvary24-)
- [가격 플랜 가이드](https://steppay.stoplight.io/docs/guide/fmi0buxwf1zj3-)
- [구독 가이드](https://steppay.stoplight.io/docs/guide/ah2bzz8utfpfn-)

## 사전 준비 작업

- [Secret-Token 확인하기](https://steppay.stoplight.io/docs/guide/urvjmavys1lar-#1-secret-token)

<!-- theme: warning -->
> 현재 V1 API를 통해 사용량 템플릿을 생성할 수 없기 때문에 사용량 가격 플랜은 포탈에서 생성해야 합니다.

## 레코드와 쿼타

**사용량 기록은 고객이 얼마의 유닛을 사용 했는지를 나타내는 ‘레코드’와 고객에게 할당된 최대 사용 유닛을 뜻하는 ‘쿼타’로 이루어져 있습니다.** 레코드와 쿼타는 등록 시간과 증감 유닛수를 가지고 있는 시계열(Time series) 자료형입니다. 레코드와 쿼타의 변화량을 사용량 기록 API 를 통해 등록하면 스텝페이에서는 각 값의 시간에 따른 누적 합(accumulated sum)을 관리하며 요금 산정 및 사용량 제한에 사용됩니다. 아래 표는 쿼타-레코드 기록의 예시입니다.

| 시간 | 쿼타 | 쿼타 누적 합 | 레코드 | 레코드 누적 합 |
| --- | --- | --- | --- | --- |
| t0 | +5 | 5 | 0 | 0 |
| t1 | 0 | 5 | +2 | 2 |
| t3 | -2 | 3 | +1 | 3 |
| … | … | … | … | … |

- 레코드 누적 합은 쿼타 누적 합보다 항상 작거나 같아야합니다. 
- 모든 쿼타를 다 채웠다면 추가 레코드를 기록하기 위해서는 반드시 쿼타를 증가시켜야 합니다. 
- 쿼타는 선불 청구 방식에서는 필수값이지만 후불 청구 방식에서는 연동 시스템에 따라 사용하거나 기록하지 않을 수 있습니다. 
- 반대로 후불 청구방식에서 레코드는 필수 요소이지만 쿼타는 선택적으로 사용 가능합니다. 
- 쿼타를 지정하지 않은 후불 청구 방식의 경우 쿼타는 무한대로 간주됩니다.

## 사용량

사용량 기반 과금 플랜과 계정수 기반 과금 플랜은 모두 레코드와 쿼타에 기반해 결제해야 할 금액을 산정한다는 점에서 공통점이 있지만 그 동작 방식에서 몇가지 차이점이 있습니다. 

사용량 기반 과금 플랜은 API 호출 횟수, 네트워크 트래픽과 같은 측정할 수 있는 양에 따라 결제 금액을 산정하는 과금 모델입니다. **사용량 기반 과금 플랜에서는 기록한 레코드 혹은 쿼타의 누적 합(cumulative sum)이 곧 사용량 유닛이 됩니다.** 사용 유닛 구간에 따른 단위 사용량 당 금액에 기반하여 결제 금액이 산정됩니다.

사용량 과금은 기본적으로 구간을 나누어 특정 구간에 과금 템플릿을 적용하게 됩니다. 이 템플릿을 사용량 테이블이라고도 합니다.
스텝페이에서 지원하는 사용량 템플릿은 크게 두 가지가 있습니다.

1. 구간별 고정 요금 템플릿
2. 구간별 건당 과금 템플릿

고정 요금 템플릿은 사용량 구간에 대해 고정된 요금을 과금합니다. 건당 과금 템플릿은 사용량 구간에 대해 건당 요금을 과금합니다.
사용량 기반 과금의 결제는 정해진 구독 주기 동안 사용량이 합산되어 결제됩니다. 

사용량 기반 과금 플랜의 레코드 누적 합은 시간에 따라 지속되는 양이 아니므로, 구독 갱신시 초기화 되며 다음 주기의 쿼타-레코드 기록에 따라 금액이 다시 산정됩니다.

## 사용량 과금 템플릿

### 구간별 고정 요금 템플릿

구간별 고정 요금 템플릿이란, 사용 유닛에 대해 정해진 구간 별로 고정 금액을 청구하는 방식입니다. 이 요금제는 정해진 사용 유닛 구간에 해당하는 고정 요금을 지불하게 됩니다. 특정 구간을 넘어서면 다음 구간의 요금과 합산되어 누적된 금액이 결제됩니다.

![range_template.png](https://docs-image-translator-qpz5cerjg-steppay.vercel.app/api/localize?dir=04_price_plan&name=04-1_usage/range_template.png)

예를 들어, API 호출 구간에 대해 고정 사용량 요금제를 아래와 같이 만들 수 있습니다.

<!--
focus: false
-->

![range_template_example.png](https://docs-image-translator-qpz5cerjg-steppay.vercel.app/api/localize?dir=04_price_plan&name=04-1_usage/range_template_example.png)

- `1,000유닛`을 사용한 경우, 0원이 결제됩니다.
- `1,500유닛`을 사용한 경우, 20,000원이 결제됩니다.
- `12,000유닛`을 사용한 경우, 40,000원이 결제됩니다.
- `150,000유닛`을 사용한 경우, 80,000원이 결제됩니다.

### 구간별 건당 과금 템플릿

구간별 건당 과금 템플릿이란, 사용 유닛의 구간에 대해 건당 금액을 청구하는 방식입니다. 이 요금제는 정해진 구간에 대해 건당 요금을 부과하게 됩니다. 전체 사용 건수가 특정 구간을 넘어서면 다음 구간의 요금으로 건당 요금이 부과됩니다.

![range_template_example.png](https://docs-image-translator-qpz5cerjg-steppay.vercel.app/api/localize?dir=04_price_plan&name=04-1_usage/count_template.png)

예를 들어, API 사용량을 건당 사용량 요금제로 만들면 아래와 같이 만들 수 있습니다.

<!--
focus: false
-->

![range_template_example.png](https://docs-image-translator-qpz5cerjg-steppay.vercel.app/api/localize?dir=04_price_plan&name=04-1_usage/count_template_example.png)

- `1,000유닛`을 사용한 경우, 총 0원이 결제됩니다.
- `1,500유닛`을 사용한 경우, (0원 * 1,000건) + (10원 * 500건)을 합산하여 총 5,000원이 결제 됩니다.
- `12,000유닛`을 사용한 경우, (0원 * 1,000건) + (10원 * 9,000건) + (5원 * 2,000건)을 합산하여 총 100,000원이 결제됩니다.
- `150,000유닛`을 사용한 경우, (0원 * 1,000건 + 10원 * 9,000건 + 5원 * 40,000건 + 2원 * 50,000건 + 1원 * 50,000건)을 합산하여 총 440,000원이 결제됩니다.

## 사용량/계정수 API

| 기능                                                                | Method | Endpoint                                                                |
|-------------------------------------------------------------------|--------|-------------------------------------------------------------------------|
| [사용량/계정 기록](https://steppay.stoplight.io/docs/api-reference/heke1tv1malpy-create-a-api-v-1-usage)  | POST   | /v1/usage_records                                                       |
| [사용량 정산](https://steppay.stoplight.io/docs/api-reference/0gtvfg6rue4bz-) | GET    | /v1/subscriptions/{subscriptionId}/calculate                                      |


### 사용량/계정수 - 사용량 기록

사용자가 서비스를 구독하고 주문을 완료하면, 해당 주문의 정보를 통해 시작된 구독의 ID와 구독 항목 ID를 받을 수 있습니다. 이 ID 정보를 사용하여 [사용량/계정 기록 API](https://steppay.stoplight.io/docs/api-reference/heke1tv1malpy-create-a-api-v-1-usage) 를 호출하면, 시스템은 전송한 계정 수 만큼의 사용량을 기록합니다.

### 사용량/계정수 - 정산

[사용량 정산 API](https://steppay.stoplight.io/docs/api-reference/0gtvfg6rue4bz-)를 호출하면 현재까지의 사용량과 그에 따른 예상 결제 금액을 확인할 수 있습니다.


### 첫 결제 할인

사용량 템플릿에 ‘첫 결제 할인’ 플랜 위젯을 적용하는 경우, 플랜의 기본 금액에 대해 할인된 가격으로 결제됩니다. 현재 사용량 합계에 대한 할인은 제공되지 않습니다.

### 사용량/계정수 구독 취소

사용량 구독을 취소하는 경우 플랜의 기본 금액에 대해 환불되며, 이미 사용한 계정수에 대해서는 따로 환불 처리를 하지 않으면 후불 결제됩니다. 
사용량 환불을 원하는 경우에는 취소된 구독의 ‘관련 주문 탭’에서 사용량 주문을 환불 처리해야 합니다.

### 계정수 사용량 알림

#### ✔️ 결제 예정 알림

정해진 구독 주기 동안의 사용량이 합산되어 결제되는 ‘사용량 기반 상품'의 경우, 결제 예정일 7일 전에 안내 메일이 발송됩니다. 
고객은 계정 수가 얼마나 되고, 어떤 과금에 의하여 결제 금액이 과금되는지 상세 내역을 확인할 수 있습니다.

#### ✔️ 주문 완료 알림

결제 완료시 주문 완료 메일이 발송됩니다. 고객은 사용량이 얼마나 되고, 어떤 과금에 의하여 결제 금액이 과금되는지 상세 내역을 확인할 수 있습니다.

</br>
